<!DOCTYPE HTML>
<html>
<head>
    <title>HPNY 2026</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
     <audio
      loop
      id="bgMusic"
      src="https://cdn.pixabay.com/audio/2025/10/12/audio_c4109f7a7d.mp3"
    ></audio>
    <canvas id="canvas"></canvas>
    <div id="root"></div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let fireworks = [];
        let particles = [];
        let textParticles = [];
        let hue = 0;
        let timer = 0;
        let textShown = false;

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.addEventListener('resize', resize);
        resize();

        const random = (min, max) => Math.random() * (max - min) + min;

        class Firework {
            constructor(sx, sy, tx, ty) {
                this.x = sx; this.y = sy;
                this.tx = tx; this.ty = ty;
                this.speed = 2;
                this.acceleration = 1.05;
                this.angle = Math.atan2(ty - sy, tx - sx);
                this.hue = random(0, 360); // Mỗi quả pháo có màu riêng
            }
            update(index) {
                this.speed *= this.acceleration;
                let vx = Math.cos(this.angle) * this.speed;
                let vy = Math.sin(this.angle) * this.speed;
                if(Math.abs(this.x - this.tx) < 10 && Math.abs(this.y - this.ty) < 10) {
                    createParticles(this.tx, this.ty, this.hue);
                    fireworks.splice(index, 1);
                } else {
                    this.x += vx; this.y += vy;
                }
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI*2);
                ctx.fillStyle = `hsl(${this.hue}, 100%, 50%)`;
                ctx.fill();
            }
        }

        class Particle {
            constructor(x, y, h) {
                this.x = x; this.y = y;
                this.angle = random(0, Math.PI * 2);
                this.speed = random(1, 10);
                this.friction = 0.95;
                this.gravity = 0.7;
                this.alpha = 1;
                this.hue = h;
                this.decay = random(0.015, 0.03);
            }
            update(index) {
                this.speed *= this.friction;
                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed + this.gravity;
                this.alpha -= this.decay;
                if(this.alpha <= this.decay) particles.splice(index, 1);
            }
            draw() {
                ctx.fillStyle = `hsla(${this.hue}, 100%, 50%, ${this.alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 1.5, 0, Math.PI*2);
                ctx.fill();
            }
        }

        class TextParticle {
            constructor(x, y) {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.destX = x;
                this.destY = y;
                this.baseHue = random(0, 360);
            }
            draw() {
                this.x += (this.destX - this.x) * 0.07;
                this.y += (this.destY - this.y) * 0.07;
                let currentHue = (this.baseHue + hue) % 360;
                ctx.fillStyle = `hsl(${currentHue}, 100%, 60%)`;
                ctx.fillRect(this.x, this.y, 2.2, 2.2);
            }
        }

        function createParticles(x, y, h) {
            let count = 60;
            while(count--) particles.push(new Particle(x, y, h));
        }

        function initText() {
            const offscreen = document.createElement('canvas');
            const offCtx = offscreen.getContext('2d');
            offscreen.width = width;
            offscreen.height = height;
            let fontSize = Math.min(width / 10, 100);
            offCtx.font = `bold ${fontSize}px Arial`;
            offCtx.textAlign = "center";
            offCtx.textBaseline = "middle";
            offCtx.fillStyle = "white";
            offCtx.fillText("Ya húuuuu!!!", width/2, 300);
            offCtx.fillText("Happy new year",width/2,400)
            offCtx.fillText("nha cưnggg!!!", width/2, 500);

            const imageData = offCtx.getImageData(0, 0, width, height).data;
            for (let y = 0; y < height; y += 4) {
                for (let x = 0; x < width; x += 4) {
                    if (imageData[(y * width + x) * 4 + 3] > 128) {
                        textParticles.push(new TextParticle(x, y));
                    }
                }
            }
        }

        function loop() {
            requestAnimationFrame(loop);
            timer++;
            hue += 2;

            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(0, 0, width, height);
            ctx.globalCompositeOperation = 'lighter';

            // --- CẢI TIẾN: PHÁO BẮN LIÊN TỤC ---
            // Luôn có 5% cơ hội bắn pháo mỗi khung hình (kể cả sau 3s)
            let launchChance = (timer < 180) ? 0.2 : 0.05; 
            if (Math.random() < launchChance) {
                fireworks.push(new Firework(random(0, width), height, random(50, width-50), random(50, height/1.8)));
            }

            // Kích hoạt dòng chữ sau 3 giây
            if (timer >= 180 && !textShown) {
                initText();
                textShown = true;
            }

            fireworks.forEach((f, i) => { f.draw(); f.update(i); });
            particles.forEach((p, i) => { p.draw(); p.update(i); });
            
            if (textShown) {
                textParticles.forEach(p => p.draw());
            }
        }

        loop();
        // Cho phép người dùng click bắn thêm pháo tùy ý
        canvas.addEventListener('mousedown', (e) => {
            fireworks.push(new Firework(width/2, height, e.clientX, e.clientY));
        });
    </script>
</body>
</html>
